
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>oopinterface &#8212; hn2016_falwa 0.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for oopinterface</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">pi</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>

<span class="kn">from</span> <span class="nn">hn2016_falwa</span> <span class="k">import</span> <span class="n">utilities</span>
<span class="kn">from</span> <span class="nn">interpolate_fields</span> <span class="k">import</span> <span class="n">interpolate_fields</span>
<span class="kn">from</span> <span class="nn">compute_reference_states</span> <span class="k">import</span> <span class="n">compute_reference_states</span>
<span class="kn">from</span> <span class="nn">compute_lwa_and_barotropic_fluxes</span> <span class="k">import</span> <span class="n">compute_lwa_and_barotropic_fluxes</span>


<div class="viewcode-block" id="QGField"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField">[docs]</a><span class="k">class</span> <span class="nc">QGField</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Local wave activity and flux analysis in quasi-geostrophic framework</span>
<span class="sd">    that can be used to reproduce the results in:</span>
<span class="sd">    Nakamura and Huang, Atmospheric Blocking as a Traffic Jam in the Jet Stream, Science (2018).</span>
<span class="sd">    Note that topography is assumed flat in this object.</span>

<span class="sd">    .. versionadded:: 0.3.0</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xlon : numpy.array</span>
<span class="sd">           Array of evenly-spaced longitude (in degree) of size nlon.</span>
<span class="sd">    ylat : numpy.array</span>
<span class="sd">           Array of evenly-spaced latitude (in degree) of size nlat.</span>
<span class="sd">    plev : numpy.</span>
<span class="sd">           Array of pressure level (in hPa) of size nlev.</span>
<span class="sd">    u_field : numpy.ndarray</span>
<span class="sd">           Three-dimensional array of zonal wind field (in m/s) of dimension [nlev, nlat, nlon].</span>
<span class="sd">    v_field : numpy.ndarray</span>
<span class="sd">           Three-dimensional array of meridional wind field (in m/s) of dimension [nlev, nlat, nlon].</span>
<span class="sd">    t_field : numpy.ndarray</span>
<span class="sd">           Three-dimensional array of temperature field (in K) of dimension [nlev, nlat, nlon].</span>
<span class="sd">    kmax : int, optional</span>
<span class="sd">           Dimension of uniform pseudoheight grids used for interpolation.</span>
<span class="sd">    maxit : int, optional</span>
<span class="sd">           Number of iteration by the Successive over-relaxation (SOR) solver to compute the reference states.</span>
<span class="sd">    dz : float, optional</span>
<span class="sd">           Size of uniform pseudoheight grids (in meters).</span>
<span class="sd">    prefactor : float, optional</span>
<span class="sd">           Vertical air density summed over height.</span>
<span class="sd">    npart : int, optional</span>
<span class="sd">           Number of partitions used to compute equivalent latitude.</span>
<span class="sd">           If not initialized, it will be set to nlat.</span>
<span class="sd">    tol : float, optional</span>
<span class="sd">           Tolerance that defines the convergence of solution in SOR solver.</span>
<span class="sd">    rjac : float, optional</span>
<span class="sd">           Spectral radius of the Jacobi iteration in the SOR solver.</span>
<span class="sd">    scale_height : float, optional</span>
<span class="sd">           Scale height of the atmosphere in meters. Default = 7000.</span>
<span class="sd">    cp : float, optional</span>
<span class="sd">           Heat capacity of dry air in J/kg-K. Default = 1004.</span>
<span class="sd">    dry_gas_constant : float, optional</span>
<span class="sd">           Gas constant for dry air in J/kg-K. Default = 287.</span>
<span class="sd">    omega : float, optional</span>
<span class="sd">           Rotation rate of the earth in 1/s. Default = 7.29e-5.</span>
<span class="sd">    planet_radius : float, optional</span>
<span class="sd">           Radius of the planet in meters.</span>
<span class="sd">           Default = 6.378e+6 (Earth&#39;s radius).</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; test_object = QGField(xlon, ylat, plev,</span>
<span class="sd">                             u_field, v_field, t_field)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlon</span><span class="p">,</span> <span class="n">ylat</span><span class="p">,</span> <span class="n">plev</span><span class="p">,</span>
                 <span class="n">u_field</span><span class="p">,</span> <span class="n">v_field</span><span class="p">,</span> <span class="n">t_field</span><span class="p">,</span>
                 <span class="n">kmax</span><span class="o">=</span><span class="mi">49</span><span class="p">,</span> <span class="n">maxit</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">prefactor</span><span class="o">=</span><span class="mf">6500.</span><span class="p">,</span>
                 <span class="n">npart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">,</span> <span class="n">rjac</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                 <span class="n">scale_height</span><span class="o">=</span><span class="mf">7000.</span><span class="p">,</span> <span class="n">cp</span><span class="o">=</span><span class="mf">1004.</span><span class="p">,</span> <span class="n">dry_gas_constant</span><span class="o">=</span><span class="mf">287.</span><span class="p">,</span>
                 <span class="n">omega</span><span class="o">=</span><span class="mf">7.29e-5</span><span class="p">,</span> <span class="n">planet_radius</span><span class="o">=</span><span class="mf">6.378e+6</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a QGField object.</span>
<span class="sd">        This only initialize the attributes of the object. Analysis and</span>
<span class="sd">        computation are done by calling various methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if ylat is in ascending order and include the equator</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ylat</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ylat must be in ascending order&quot;</span><span class="p">)</span>
        <span class="c1"># Even grid</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ylat</span><span class="o">.</span><span class="n">size</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ylat</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span> <span class="o">=</span> <span class="n">ylat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">ylat</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># Fortran indexing starts from 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># raise TypeError(&quot;ylat must include the equator (i.e. degree 0)&quot;)</span>
        <span class="c1"># Odd grid</span>
        <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ylat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span> <span class="o">=</span> <span class="n">ylat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">ylat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># Fortran indexing starts from 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;There are more than 1 grid point with latitude 0.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">)))</span>

        <span class="c1"># === Check if plev is in decending order ===</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">plev</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;plev must be in decending order&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plev</span> <span class="o">=</span> <span class="n">plev</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlon</span> <span class="o">=</span> <span class="n">xlon</span>

        <span class="c1"># === Check the shape of wind/temperature fields ===</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlev</span><span class="p">,</span> <span class="n">nlat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span> <span class="o">=</span> <span class="n">plev</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ylat</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">xlon</span><span class="o">.</span><span class="n">size</span>
        <span class="n">expected_dimension</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlev</span><span class="p">,</span> <span class="n">nlat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u_field</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">expected_dimension</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Incorrect dimension of u_field. Expected dimension: </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_dimension</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">v_field</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">expected_dimension</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Incorrect dimension of v_field. Expected dimension: </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_dimension</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">t_field</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">expected_dimension</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Incorrect dimension of t_field. Expected dimension: </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_dimension</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># === Do Interpolation on latitude grid if needed ===</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
            <span class="n">interp_u</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span><span class="p">,</span> <span class="n">u_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span>
            <span class="p">)</span>
            <span class="n">interp_v</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span><span class="p">,</span> <span class="n">v_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span>
            <span class="p">)</span>
            <span class="n">interp_t</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span><span class="p">,</span> <span class="n">t_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_field</span> <span class="o">=</span> <span class="n">interp_u</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_field</span> <span class="o">=</span> <span class="n">interp_v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_field</span> <span class="o">=</span> <span class="n">interp_t</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_field</span> <span class="o">=</span> <span class="n">u_field</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_field</span> <span class="o">=</span> <span class="n">v_field</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_field</span> <span class="o">=</span> <span class="n">t_field</span>

        <span class="c1"># === To be computed ===</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">180.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlambda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlon</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">npart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">npart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">npart</span> <span class="o">=</span> <span class="n">npart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">dz</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmax</span><span class="p">)])</span>

        <span class="c1"># === Parameters ===</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmax</span> <span class="o">=</span> <span class="n">kmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxit</span> <span class="o">=</span> <span class="n">maxit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="n">dz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefactor</span> <span class="o">=</span> <span class="n">prefactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rjac</span> <span class="o">=</span> <span class="n">rjac</span>

        <span class="c1"># === Constants ===</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_height</span> <span class="o">=</span> <span class="n">scale_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">cp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dry_gas_constant</span> <span class="o">=</span> <span class="n">dry_gas_constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span> <span class="o">=</span> <span class="n">planet_radius</span>

        <span class="c1"># === Variables that will be computed in methods ===</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qgpv_temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u_temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v_temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta_temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_stability</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qref_temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uref_temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptref_temp</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="QGField.get_latitude_dim"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_latitude_dim">[docs]</a>    <span class="k">def</span> <span class="nf">get_latitude_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the latitude dimension of the input data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlat</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlat</span></div>

    <span class="k">def</span> <span class="nf">_interp_back</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">field</span><span class="p">,</span>
        <span class="n">interp_from</span><span class="p">,</span>
        <span class="n">interp_to</span><span class="p">,</span>
        <span class="n">which_axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Internal function to interpolate the results from odd grid to even grid. If the initial input to the QGField object is an odd grid, error will be raised.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;No need for such interpolation.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">interp1d</span><span class="p">(</span>
                <span class="n">interp_from</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">which_axis</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span>
            <span class="p">)(</span><span class="n">interp_to</span><span class="p">)</span>

<div class="viewcode-block" id="QGField.interpolate_fields"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.interpolate_fields">[docs]</a>    <span class="k">def</span> <span class="nf">interpolate_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate zonal wind, maridional wind, and potential temperature field onto the uniform pseudoheight grids, and compute QGPV on the same grids.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        qgpv : numpy.ndarray</span>
<span class="sd">            Three-dimensional array of quasi-geostrophic potential vorticity (QGPV) with dimension = [kmax, nlat, nlon]</span>

<span class="sd">        interpolated_u : numpy.ndarray</span>
<span class="sd">            Three-dimensional array of interpolated zonal wind with dimension = [kmax, nlat, nlon]</span>

<span class="sd">        interpolated_v : numpy.ndarray</span>
<span class="sd">            Three-dimensional array of interpolated meridional wind with dimension = [kmax, nlat, nlon]</span>

<span class="sd">        interpolated_theta : numpy.ndarray</span>
<span class="sd">            Three-dimensional array of interpolated potential temperature with dimension = [kmax, nlat, nlon]</span>

<span class="sd">        static_stability : numpy.array</span>
<span class="sd">            One-dimension array of interpolated static stability with dimension = kmax</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; qgpv, interpolated_u, interpolated_v,</span>
<span class="sd">            interpolated_theta, static_stability</span>
<span class="sd">            = test_object.interpolate_fields()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qref_temp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># === Interpolate fields and obtain qgpv ===</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qgpv_temp</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u_temp</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v_temp</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta_temp</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">static_stability</span> <span class="o">=</span> \
                <span class="n">interpolate_fields</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_field</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_field</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_field</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">plev</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">scale_height</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">dry_gas_constant</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">qgpv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qgpv_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
            <span class="c1"># Interpolate back to original grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qgpv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qgpv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qgpv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_stability</span></div>

<div class="viewcode-block" id="QGField.get_qgpv"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_qgpv">[docs]</a>    <span class="k">def</span> <span class="nf">get_qgpv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the interpolated quasi-geostrophic potential vorticity field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qgpv</span></div>

<div class="viewcode-block" id="QGField.get_u"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_u">[docs]</a>    <span class="k">def</span> <span class="nf">get_u</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the interpolated zonal wind field [m/s].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u</span></div>

<div class="viewcode-block" id="QGField.get_v"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_v">[docs]</a>    <span class="k">def</span> <span class="nf">get_v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the interpolated meridional wind field [m/s].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v</span></div>

<div class="viewcode-block" id="QGField.get_theta"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_theta">[docs]</a>    <span class="k">def</span> <span class="nf">get_theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the interpolated potential temperature field [K].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta</span></div>

<div class="viewcode-block" id="QGField.get_static_stability"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_static_stability">[docs]</a>    <span class="k">def</span> <span class="nf">get_static_stability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the interpolated static stability.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_stability</span></div>

<div class="viewcode-block" id="QGField.compute_reference_states"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.compute_reference_states">[docs]</a>    <span class="k">def</span> <span class="nf">compute_reference_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">northern_hemisphere_results_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the local wave activity and reference states of QGPV, zonal wind and potential temperature using a more stable inversion algorithm applied in Nakamura and Huang (2018, Science). The equation to be invert is equation (22) in supplementary materials of Huang and Nakamura (2017, GRL). In this version, only values in the Northern Hemisphere is computed.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        northern_hemisphere_results_only : bool</span>
<span class="sd">               If true, arrays of size [kmax, nlat//2+1] will be returned. Otherwise, arrays of size [kmax, nlat] will be returned. This parameter is present since the current version (v0.3.1) of the package only return analysis in the northern hemisphere. Default: True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        qref : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of reference state of quasi-geostrophic potential vorticity (QGPV) with dimension = [kmax, nlat, nlon] if northern_hemisphere_results_only=False, or dimension = [kmax, nlat//2+1, nlon] if northern_hemisphere_results_only=True</span>

<span class="sd">        uref : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of reference state of zonal wind (Uref) with dimension = [kmax, nlat, nlon] if northern_hemisphere_results_only=False, or dimension = [kmax, nlat//2+1, nlon] if northern_hemisphere_results_only=True</span>

<span class="sd">        ptref : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of reference state of potential temperature (Theta_ref) with dimension = [kmax, nlat, nlon] if northern_hemisphere_results_only=False, or dimension = [kmax, nlat//2+1, nlon] if northern_hemisphere_results_only=True</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; qref, uref, ptref = test_object.compute_reference_states()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">northern_hemisphere_results_only</span> <span class="o">=</span> \
            <span class="n">northern_hemisphere_results_only</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qgpv_temp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_fields</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uref_temp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># === Compute reference states in Northern Hemisphere ===</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qref_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uref_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptref_temp</span> <span class="o">=</span> \
                <span class="n">compute_reference_states</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qgpv_temp</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u_temp</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta_temp</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">static_stability</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">npart</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">maxit</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">scale_height</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">dry_gas_constant</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">rjac</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">qref_temp_right_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qref_temp</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">northern_hemisphere_results_only</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qref_temp_right_unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uref_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ptref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ptref_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ylat_interp_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qref</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
                    <span class="n">ylat_interp_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span><span class="p">[</span>
                        <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span>
                   <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qref</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">kmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qref_temp_right_unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uref</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">kmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uref_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ptref</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">kmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ptref_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="n">ylat_interp_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
                    <span class="n">ylat_interp_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">qref</span><span class="p">,</span> <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">uref</span><span class="p">,</span> <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ptref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ptref</span><span class="p">,</span> <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptref</span></div>


<div class="viewcode-block" id="QGField.get_qref"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_qref">[docs]</a>    <span class="k">def</span> <span class="nf">get_qref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the QGPV reference state [1/s].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qref</span></div>


<div class="viewcode-block" id="QGField.get_uref"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_uref">[docs]</a>    <span class="k">def</span> <span class="nf">get_uref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the zonal wind reference state [m/s].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uref</span></div>


<div class="viewcode-block" id="QGField.get_ptref"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.get_ptref">[docs]</a>    <span class="k">def</span> <span class="nf">get_ptref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the potential temperature reference state [K].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptref</span></div>


<div class="viewcode-block" id="QGField.compute_lwa_and_barotropic_fluxes"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.QGField.compute_lwa_and_barotropic_fluxes">[docs]</a>    <span class="k">def</span> <span class="nf">compute_lwa_and_barotropic_fluxes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">northern_hemisphere_results_only</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute barotropic components of local wave activity and flux terms in eqs.(2) and (3) in Nakamura and Huang (Science, 2018).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        northern_hemisphere_results_only : bool</span>
<span class="sd">               If true, arrays of size [kmax, nlat//2] will be returned. Otherwise, arrays of size [kmax, nlat] will be returned. This parameter is present since the current version (v0.3.1) of the package only return analysis in the northern hemisphere. Default: True.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        adv_flux_f1 : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of the second-order eddy term in zonal advective flux,</span>
<span class="sd">            i.e. F1 in equation 3 of NH18, with dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        adv_flux_f2 : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of the third-order eddy term in zonal advective flux,</span>
<span class="sd">            i.e. F2 in equation 3 of NH18, with dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        adv_flux_f3 : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of the remaining term in zonal advective flux,</span>
<span class="sd">            i.e. F3 in equation 3 of NH18, with dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        convergence_zonal_advective_flux : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of the convergence of zonal advective flux,</span>
<span class="sd">            i.e. -div(F1+F2+F3) in equation 3 of NH18, with dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        divergence_eddy_momentum_flux : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of the divergence of eddy momentum flux,</span>
<span class="sd">            i.e. (II) in equation 2 of NH18, with dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        meridional_heat_flux : numpy.ndarray</span>
<span class="sd">            Two-dimensional array of the low-level meridional heat flux,</span>
<span class="sd">            i.e. (III) in equation 2 of NH18, with dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        lwa_baro : np.ndarray</span>
<span class="sd">            Two-dimensional array of barotropic local wave activity (with cosine weighting). Dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        u_baro     : np.ndarray</span>
<span class="sd">            Two-dimensional array of barotropic zonal wind (without cosine weighting). Dimension = [nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [nlat, nlon] if northern_hemisphere_results_only=False.</span>

<span class="sd">        lwa : np.ndarray</span>
<span class="sd">            Three-dimensional array of barotropic local wave activity Dimension = [kmax, nlat//2+1, nlon] if northern_hemisphere_results_only=True, or dimension = [kmax, nlat, nlon] if northern_hemisphere_results_only=False.</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; adv_flux_f1, adv_flux_f2, adv_flux_f3, convergence_zonal_advective_flux,</span>
<span class="sd">            divergence_eddy_momentum_flux, meridional_heat_flux,</span>
<span class="sd">            lwa_baro, u_baro, lwa = test_object.compute_lwa_and_barotropic_fluxes()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qgpv_temp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_fields</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uref_temp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_reference_states</span><span class="p">()</span>

        <span class="c1"># === Compute barotropic flux terms ===</span>
        <span class="n">lwa</span><span class="p">,</span> <span class="n">astarbaro</span><span class="p">,</span> <span class="n">ua1baro</span><span class="p">,</span> <span class="n">ubaro</span><span class="p">,</span> <span class="n">ua2baro</span><span class="p">,</span>\
            <span class="n">ep1baro</span><span class="p">,</span> <span class="n">ep2baro</span><span class="p">,</span> <span class="n">ep3baro</span><span class="p">,</span> <span class="n">ep4</span> <span class="o">=</span> \
            <span class="n">compute_lwa_and_barotropic_fluxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qgpv_temp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_u_temp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_v_temp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">interpolated_theta_temp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">qref_temp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">uref_temp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">ptref_temp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">scale_height</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">dry_gas_constant</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">prefactor</span><span class="p">)</span>

        <span class="c1"># === Compute divergence of the meridional eddy momentum flux ===</span>
        <span class="n">meri_flux_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ep2baro</span><span class="p">)</span>
        <span class="n">meri_flux_temp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ep2baro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ep3baro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> \
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span> <span class="o">*</span>
             <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>

        <span class="c1"># === Compute convergence of the zonal LWA flux ===</span>
        <span class="n">zonal_adv_flux_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">((</span><span class="n">ua1baro</span> <span class="o">+</span> <span class="n">ua2baro</span> <span class="o">+</span> <span class="n">ep1baro</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">convergence_zonal_advective_flux</span> <span class="o">=</span> \
            <span class="n">utilities</span><span class="o">.</span><span class="n">zonal_convergence</span><span class="p">(</span>
                <span class="n">zonal_adv_flux_sum</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span><span class="p">:])),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dlambda</span><span class="p">,</span>
                <span class="n">planet_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">northern_hemisphere_results_only</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ua1baro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ua2baro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ep1baro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convergence_zonal_advective_flux</span> <span class="o">=</span> \
                <span class="n">convergence_zonal_advective_flux</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meridional_heat_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ep4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lwa_baro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">astarbaro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_baro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ubaro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lwa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">lwa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">divergence_eddy_momentum_flux</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">meri_flux_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ylat_interp_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
                <span class="n">ylat_interp_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span><span class="p">[</span>
                    <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f1</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ua1baro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                                          <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ua2baro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                                          <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ep1baro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">convergence_zonal_advective_flux</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">convergence_zonal_advective_flux</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">meridional_heat_flux</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ep4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lwa_baro</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">astarbaro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">u_baro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">ubaro</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lwa</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">kmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">lwa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">divergence_eddy_momentum_flux</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">equator_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">meri_flux_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="n">ylat_interp_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>
                <span class="n">ylat_interp_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylat_no_equator</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_latitude_interpolation</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f1</span><span class="p">,</span> <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span><span class="p">,</span>
                <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f2</span><span class="p">,</span> <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span><span class="p">,</span>
                <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f3</span><span class="p">,</span> <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span><span class="p">,</span>
                <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convergence_zonal_advective_flux</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convergence_zonal_advective_flux</span><span class="p">,</span>
                                  <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span><span class="p">,</span>
                                  <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">divergence_eddy_momentum_flux</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">divergence_eddy_momentum_flux</span><span class="p">,</span> 
                                  <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span><span class="p">,</span>
                                  <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meridional_heat_flux</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meridional_heat_flux</span><span class="p">,</span>
                                  <span class="n">ylat_interp_from</span><span class="p">,</span> <span class="n">ylat_interp_to</span><span class="p">,</span>
                                  <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lwa_baro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lwa_baro</span><span class="p">,</span>
                                              <span class="n">ylat_interp_from</span><span class="p">,</span>
                                              <span class="n">ylat_interp_to</span><span class="p">,</span>
                                              <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_baro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_baro</span><span class="p">,</span>
                                            <span class="n">ylat_interp_from</span><span class="p">,</span>
                                            <span class="n">ylat_interp_to</span><span class="p">,</span>
                                            <span class="n">which_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lwa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interp_back</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lwa</span><span class="p">,</span>
                                         <span class="n">ylat_interp_from</span><span class="p">,</span>
                                         <span class="n">ylat_interp_to</span><span class="p">,</span>
                                         <span class="n">which_axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adv_flux_f3</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">convergence_zonal_advective_flux</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">divergence_eddy_momentum_flux</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">meridional_heat_flux</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">lwa_baro</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_baro</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lwa</span></div></div>


<span class="k">def</span> <span class="nf">curl_2D</span><span class="p">(</span><span class="n">ufield</span><span class="p">,</span> <span class="n">vfield</span><span class="p">,</span> <span class="n">clat</span><span class="p">,</span> <span class="n">dlambda</span><span class="p">,</span> <span class="n">dphi</span><span class="p">,</span> <span class="n">planet_radius</span><span class="o">=</span><span class="mf">6.378e+6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assuming regular latitude and longitude [in degree] grid, compute the curl</span>
<span class="sd">    of velocity on a pressure level in spherical coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">((</span><span class="n">ufield</span><span class="p">))</span>
    <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vfield</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">vfield</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">dlambda</span><span class="p">)</span> <span class="o">-</span> \
                      <span class="p">(</span><span class="n">ufield</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">clat</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span>
                       <span class="n">ufield</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">clat</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">dphi</span><span class="p">)</span>
    <span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">ans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">vfield</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vfield</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">dlambda</span><span class="p">)</span> <span class="o">-</span>
                    <span class="p">(</span><span class="n">ufield</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">clat</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span>
                     <span class="n">ufield</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">clat</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">dphi</span><span class="p">))</span>
    <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">vfield</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vfield</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">dlambda</span><span class="p">)</span> <span class="o">-</span>
                     <span class="p">(</span><span class="n">ufield</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">clat</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span>
                      <span class="n">ufield</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">clat</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">dphi</span><span class="p">))</span>
    <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">planet_radius</span> <span class="o">/</span> <span class="n">clat</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ans</span>


<div class="viewcode-block" id="BarotropicField"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.BarotropicField">[docs]</a><span class="k">class</span> <span class="nc">BarotropicField</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object that deals with barotropic (2D) wind and/or PV fields</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        xlon : np.array</span>
<span class="sd">            Longitude array in degree with dimension = nlon.</span>

<span class="sd">        ylat : np.array</span>
<span class="sd">            Latitude array in degree with dimension = nlat.</span>

<span class="sd">        area : np.ndarray</span>
<span class="sd">            Differential area at each lon-lat grid points with dimension (nlat,nlon). If &#39;area=None&#39;: it will be initiated as area of uniform grid (in degree) on a spherical surface. Dimension = [nlat, nlon]</span>

<span class="sd">        dphi : np.array</span>
<span class="sd">            Differential length element along the lat grid with dimension = nlat.</span>

<span class="sd">        pv_field : np.ndarray</span>
<span class="sd">            Absolute vorticity field with dimension [nlat x nlon]. If &#39;pv_field=None&#39;: pv_field is expected to be computed with u,v,t field.</span>


<span class="sd">    Example</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; barofield1 = BarotropicField(xlon, ylat, pv_field=abs_vorticity)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlon</span><span class="p">,</span> <span class="n">ylat</span><span class="p">,</span> <span class="n">pv_field</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dphi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">n_partitions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">planet_radius</span><span class="o">=</span><span class="mf">6.378e+6</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a windtempfield object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            xlon : np.array</span>
<span class="sd">                Longitude array in degree with dimension = nlon.</span>

<span class="sd">            ylat : np.array</span>
<span class="sd">                Latitude array in degree with dimension = nlat.</span>

<span class="sd">            area : np.ndarray</span>
<span class="sd">                Differential area at each lon-lat grid points with dimension (nlat,nlon). If &#39;area=None&#39;: it will be initiated as area of uniform grid (in degree) on a spherical surface. Dimension = [nlat, nlon]</span>

<span class="sd">            dphi : np.array</span>
<span class="sd">                Differential length element along the lat grid with dimension = nlat.</span>

<span class="sd">            pv_field : np.ndarray</span>
<span class="sd">                Absolute vorticity field with dimension = [nlat, nlon].</span>
<span class="sd">                If none, pv_field is expected to be computed with u,v,t field.</span>

<span class="sd">            &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xlon</span> <span class="o">=</span> <span class="n">xlon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span> <span class="o">=</span> <span class="n">ylat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">ylat</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span> <span class="o">=</span> <span class="n">xlon</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlat</span> <span class="o">=</span> <span class="n">ylat</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span> <span class="o">=</span> <span class="n">planet_radius</span>
        <span class="k">if</span> <span class="n">dphi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nlat</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span> <span class="o">=</span> <span class="n">dphi</span>

        <span class="k">if</span> <span class="n">area</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">planet_radius</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ylat</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dphi</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nlat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pv_field</span> <span class="o">=</span> <span class="n">pv_field</span>

        <span class="k">if</span> <span class="n">n_partitions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_partitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_partitions</span> <span class="o">=</span> <span class="n">n_partitions</span>


<div class="viewcode-block" id="BarotropicField.equivalent_latitudes"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.BarotropicField.equivalent_latitudes">[docs]</a>    <span class="k">def</span> <span class="nf">equivalent_latitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute equivalent latitude with the *pv_field* stored in the object.</span>

<span class="sd">        Return</span>
<span class="sd">        ----------</span>
<span class="sd">        An numpy array with dimension (nlat) of equivalent latitude array.</span>

<span class="sd">        Example</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; barofield1 = BarotropicField(xlon, ylat, pv_field=abs_vorticity)</span>
<span class="sd">        &gt;&gt;&gt; eqv_lat = barofield1.equivalent_latitudes()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">hn2016_falwa</span> <span class="k">import</span> <span class="n">basis</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eqvlat</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">eqvlat</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv_field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_partitions</span><span class="p">,</span>
            <span class="n">planet_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqvlat</span></div>

<div class="viewcode-block" id="BarotropicField.lwa"><a class="viewcode-back" href="../Object Oriented Interface.html#oopinterface.BarotropicField.lwa">[docs]</a>    <span class="k">def</span> <span class="nf">lwa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Compute the finite-amplitude local wave activity based on the *equivalent_latitudes* and the *pv_field* stored in the object.</span>

<span class="sd">        Return</span>
<span class="sd">        ----------</span>
<span class="sd">        An 2-D numpy array with dimension [nlat,nlon] of local wave activity values.</span>

<span class="sd">        Example</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; barofield1 = BarotropicField(xlon, ylat, pv_field=abs_vorticity)</span>
<span class="sd">        &gt;&gt;&gt; eqv_lat = barofield1.equivalent_latitudes() # This line is optional</span>
<span class="sd">        &gt;&gt;&gt; lwa = barofield1.lwa()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">hn2016_falwa</span> <span class="k">import</span> <span class="n">basis</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqvlat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eqvlat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equivalent_latitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">lwa_ans</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">lwa</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nlon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv_field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqvlat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">planet_radius</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">clat</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">lwa_ans</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Object Oriented Interface.html">Object Oriented Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Basis Functions.html">Basis Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Wrapper Functions.html">Wrapper Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utility Functions.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Beta-version Functions.html">Beta-version Functions</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Clare S. Y. Huang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>